'use strict';

// MODULES //

var sumSeries = require( '@stdlib/math/base/tools/sum-series' );
var isnan = require( '@stdlib/math/base/utils/is-nan' );
var factorialln = require( '@stdlib/math/base/special/factorialln' );
var factorial = require( '@stdlib/math/base/special/factorial' );
var exp = require( '@stdlib/math/base/special/exp' );
var ln = require( '@stdlib/math/base/special/ln' );


// FUNCTIONS //

function seriesClosure( lambda ) { // eslint-disable-line 
	var lk;
	var k;
	k = 1;
	lk = lambda;
	return function seriesElement() { // eslint-disable-line 
		k += 1;
		lk *= lambda;
		return lk * factorialln( k ) / factorial( k );
	}; // end FUNCTION seriesElement()
} // end FUNCTION seriesClosure()


// MAIN //

/**
* Returns the entropy of a Poisson distribution.
*
* @param {NonNegativeNumber} lambda - mean parameter
* @returns {PositiveNumber} entropy
*
* @example
* var v = entropy( 9.0 );
* // returns ~2.508
* @example
* var v = entropy( 1.0 );
* // returns ~1.305
* @example
* var v = entropy( -0.2 );
* // returns NaN
* @example
* var v = entropy( NaN );
* // returns NaN
*/
function entropy( lambda ) {
	var gen;
	var out;
	if ( isnan( lambda ) || lambda < 0.0 ) {
		return NaN;
	}
	if ( lambda === 0.0 ) {
		return 0.0;
	}
	gen = seriesClosure( lambda );
	out = lambda * ( 1.0-ln(lambda) );
	out += exp( -lambda ) * sumSeries( gen );
	return out;
} // end FUNCTION entropy()


// EXPORTS //

module.exports = entropy;
