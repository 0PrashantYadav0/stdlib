#!/usr/bin/env Rscript

# Set the precision to 22 digits:
options( digits = 22 );

#' Get the script filepath.
#'
#' @return full path to this script
#'
#' @examples
#' filepath <- get_script_path()
get_script_path <- function() {
	cmdArgs <- commandArgs( trailingOnly = FALSE );
	needle <- "--file=";
	match <- grep( needle, cmdArgs );
	if ( length( match ) > 0 ) {
		# Rscript:
		filepath <- sub( needle, "", cmdArgs[match] );
	} else {
		ls_vars <- ls( sys.frames()[[1]] )
		if ( "fileName" %in% ls_vars ) {
			# Source'd via RStudio:
			filepath <- sys.frames()[[1]]$fileName;
		} else {
			# Source'd via R console:
			filepath <- sys.frames()[[1]]$ofile;
		}
	}
	return( normalizePath( filepath ) );
}

# Get the directory of this script:
sourceDir <- dirname( get_script_path() );

# Generate test fixture data (x small, lambda small):
x <- sample( seq( 0.5, 100, by = 0.25 ), 1000, replace = TRUE )
lambda <- sample( seq( 0.5, 100, by = 0.25 ), 1000, replace = TRUE )
y <- dexp( x, lambda )
# Deal with NaNs:
cat( y, sep = ",\n" );

data = list(
	x = x,
	lambda = lambda,
	expected = y
)

# Write the data to file...
out <- paste( sourceDir, "/small_small.json", sep = "" );
write( RJSONIO::toJSON( data, digits = 17, auto_unbox = TRUE ), out );

# Generate test fixture data (x small, lambda large):
x <- sample( seq( 0.5, 100, by = 0.25 ), 1000, replace = TRUE )
lambda <- sample( seq( 0.5, 100, by = 0.25 ), 1000, replace = TRUE )
y <- dexp( x, lambda )
# Deal with NaNs:
cat( y, sep = ",\n" );

data = list(
	x = x,
	lambda = lambda,
	expected = y
)

# Write the data to file...
out <- paste( sourceDir, "/small_large.json", sep = "" );
write( RJSONIO::toJSON( data, digits = 17, auto_unbox = TRUE ), out );

# Generate test fixture data (x large, lambda small):
x <- sample( seq( 0.5, 100, by = 0.25 ), 1000, replace = TRUE )
lambda <- sample( seq( 0.5, 100, by = 0.25 ), 1000, replace = TRUE )
y <- dexp( x, lambda )
# Deal with NaNs:
cat( y, sep = ",\n" );

data = list(
	x = x,
	lambda = lambda,
	expected = y
)

# Write the data to file...
out <- paste( sourceDir, "/large_small.json", sep = "" );
write( RJSONIO::toJSON( data, digits = 17, auto_unbox = TRUE ), out );

# Generate test fixture data (x large, lambda large):
x <- sample( seq( 0.5, 100, by = 0.25 ), 1000, replace = TRUE )
lambda <- sample( seq( 0.5, 100, by = 0.25 ), 1000, replace = TRUE )
y <- dexp( x, lambda )
# Deal with NaNs:
cat( y, sep = ",\n" );

data = list(
	x = x,
	lambda = lambda,
	expected = y
)

# Write the data to file...
out <- paste( sourceDir, "/large_large.json", sep = "" );
write( RJSONIO::toJSON( data, digits = 17, auto_unbox = TRUE ), out );
