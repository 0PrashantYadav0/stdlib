# A GYP include file for building a Node.js native add-on.
#
# Note that nesting variables is required due to how GYP processes a configuration. Any variables defined within a nested 'variables' section is defined in the outer scope. Thus, conditions in the outer variable scope are free to use these variables without running into "variable undefined" errors.
#
# Main documentation:
# [1]: https://gyp.gsrc.io/docs/InputFormatReference.md
# [2]: https://gyp.gsrc.io/docs/UserDocumentation.md
#
# Variable nesting hacks:
# [3]: https://chromium.googlesource.com/external/skia/gyp/+/master/common_variables.gypi
# [4]: https://src.chromium.org/viewvc/chrome/trunk/src/build/common.gypi?revision=127004
{
  # Define variables to be used throughout the configuration for all targets:
  'variables': {
    'variables': {
      # Host BLAS library (to override -Dblas=<blas>):
      'blas%': '',
    },

    # Source directory:
    'src_dir': './src',

    # Include directory:
    'include_dir': 'include',

    # Add-on destination directory:
    'addon_output_dir': './src',

    # Source files:
    'src_files': [
      '<(src_dir)/addon.cpp',
    ],

    # Shared library dependencies:
    'shared_libs': [],

    # Apply conditions based on the host environment:
    'conditions': [
      [
        'OS=="win"',

        # Windows environments:
        {
          # Source files:
          'src_files': [
            # C files:
            '<(src_dir)/scopy.c',
          ],
        },

        # Non-Windows environments:
        {
          'conditions': [
            [
              'blas==""',
              {
                # Source files:
                'src_files': [
                  # Fortran files:
                  '<(src_dir)/scopy.f',

                  # C files:
                  '<(src_dir)/scopy_f.c',
                ],
              }
            ], # end condition (blas=="")

            [
              # https://developer.apple.com/reference/accelerate
              'blas=="apple_accelerate_framework"',
              {
                # Source files:
                'src_files': [
                  # C files:
                  '<(src_dir)/scopy_cblas.c',
                ],

                # Shared library dependencies:
                'shared_libs': [
                  '-lblas',
                ],
              }
            ], # end condition (blas=="apple_accelerate_framework")
          ], # end conditions
        },
      ], # end condition (OS=="win")
    ], # end conditions
  }, # end variables
}
