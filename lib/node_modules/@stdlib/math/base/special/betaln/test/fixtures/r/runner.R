#!/usr/bin/env Rscript

# Set the precision to 22 digits:
options( digits = 22 );

#' Get the script filepath.
#'
#' @return full path to this script
#'
#' @examples
#' filepath <- get_script_path()
get_script_path <- function() {
	cmdArgs <- commandArgs( trailingOnly = FALSE );
	needle <- "--file=";
	match <- grep( needle, cmdArgs );
	if ( length( match ) > 0 ) {
		# Rscript:
		filepath <- sub( needle, "", cmdArgs[match] );
	} else {
		ls_vars <- ls( sys.frames()[[1]] )
		if ( "fileName" %in% ls_vars ) {
			# Source'd via RStudio:
			filepath <- sys.frames()[[1]]$fileName;
		} else {
			# Source'd via R console:
			filepath <- sys.frames()[[1]]$ofile;
		}
	}
	return( normalizePath( filepath ) );
}

# TODO: better and more comprehensive tests

# Generate test fixture data:
x <- sample( seq( 0.5, 100, by = 0.25 ), 1000, replace = TRUE )
y <- sample( seq( 0.5, 100, by = 0.25 ), 1000, replace = TRUE )
z <- lbeta( x, y )

# Deal with NaNs:
cat( y, sep = ",\n" );

# Get the directory of this script:
sourceDir <- dirname( get_script_path() );

# Write the data to file...
out <- paste( sourceDir, "/arg1.json", sep = "" );
write( RJSONIO::toJSON( x, digits = 18, auto_unbox = TRUE ), out );

out <- paste( sourceDir, "/arg2.json", sep = "" );
write( RJSONIO::toJSON( y, digits = 18, auto_unbox = TRUE ), out );

out <- paste( sourceDir, "/expected.json", sep = "" );
write( RJSONIO::toJSON( z, digits = 18, auto_unbox = TRUE ), out );
