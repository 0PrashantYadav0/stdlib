#!/usr/bin/env Rscript

# Set the precision to 16 digits:
options( digits = 16 );

#' Get the script filepath.
#'
#' @return full path to this script
#'
#' @examples
#' filepath <- get_script_path()
get_script_path <- function() {
	cmdArgs <- commandArgs( trailingOnly = FALSE );
	needle <- "--file=";
	match <- grep( needle, cmdArgs );
	if ( length( match ) > 0 ) {
		# Rscript:
		filepath <- sub( needle, "", cmdArgs[match] );
	} else {
		ls_vars <- ls( sys.frames()[[1]] )
		if ( "fileName" %in% ls_vars ) {
			# Source'd via RStudio:
			filepath <- sys.frames()[[1]]$fileName;
		} else {
			# Source'd via R console:
			filepath <- sys.frames()[[1]]$ofile;
		}
	}
	return( normalizePath( filepath ) );
}

# TODO: better and more comprehensive tests

# Generate test fixture data:
x <- seq( -100, 100, 0.5 );
y <- lfactorial( x );

# Deal with NaNs:
cat( y, sep = ",\n" );

# Get the directory of this script:
sourceDir <- dirname( get_script_path() );

# Write the data to file...
out <- paste( sourceDir, "/data.json", sep = "" );
write( jsonlite::toJSON( x, digits = 16, auto_unbox = TRUE ), out );

out <- paste( sourceDir, "/expected.json", sep = "" );
write( jsonlite::toJSON( y, digits = 16, auto_unbox = TRUE ), out );
