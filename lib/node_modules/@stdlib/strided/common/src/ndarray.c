/**
* @license Apache-2.0
*
* Copyright (c) 2018 The Stdlib Authors.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*    http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/

/**
* Functionality for creating ndarrays.
*/
#include <stdlib.h>
#include <stdint.h>
#include "stdlib/ndarray.h"

/**
* Returns a pointer to a dynamically allocated ndarray.
*
* ## Notes
*
* -   The user is responsible for freeing the allocated memory.
*
* @param data     pointer to the underlying byte array
* @param ndims    number of dimensions
* @param shape    array shape (dimensions)
* @param strides  array strides (in bytes)
* @param offset   byte offset specifying the location of the first element
* @param order    specifies whether an array is row-major (C-style) or column-major (Fortran-style)
* @param dtype    data type
* @return pointer to a dynamically allocated ndarray or, if unable to allocate memory, a null pointer
*
* @example
* #include <stdlib.h>
* #include <stdio.h>
* #include <stdint.h>
* #include "stdlib/ndarray.h"
* #include "stdlib/ndarray_order.h"
* #include "stdlib/strided_dtypes.h"
*
* // Create an underlying byte array:
* uint8_t buffer = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 };
*
* // Specify the underlying data type:
* enum STDLIB_STRIDED_DTYPES dtype = STDLIB_STRIDED_FLOAT64;
*
* // Specify the number of array dimensions:
* uint64_t ndims = 1;
*
* // Specify the array shape:
* int64_t shape = { 3 }; // vector consisting of 3 doubles
*
* // Specify the array strides:
* int64_t strides = { 8 }; // 8 bytes per double
*
* // Specify the byte offset:
* uint64_t offset = 0;
*
* // Specify the array order (note: this does not matter for a 1-dimensional array):
* enum STDLIB_NDARRAY_ORDER order = STDLIB_NDARRAY_ROW_MAJOR;
*
* // Create an `ndarray`:
* struct ndarray *x = ndarray_constructor( buffer, ndims, shape, strides, offset, order, dtype, 0 );
* if ( x == NULL ) {
*     printf( "Error allocating memory.\n" );
*     exit( 1 );
* }
*
* // Free allocated memory:
* free( x );
*/
struct ndarray * ndarray_constructor( uint8_t *data, uint64_t ndims, int64_t *shape, int64_t *strides, uint64_t offset, enum STDLIB_NDARRAY_ORDER order, enum STDLIB_STRIDED_DTYPES dtype ) {
	uint64_t len;
	uint64_t i;

	struct ndarray *arr = malloc( sizeof( struct ndarray ) );
	if ( arr == NULL ) {
		return NULL;
	}
	arr->data = data;
	arr->ndims = ndims;
	arr->shape = shape;
	arr->strides = strides;
	arr->offset = offset;
	arr->order = order;
	arr->dtype = dtype;

	// Compute the total number of elements:
	len = 0;
	for ( i = 0; i < ndims; i++ ) {
		len += shape[ i ];
	}
	arr->length = len;

	return arr;
}
