<!--

@license Apache-2.0

Copyright (c) 2018 The Stdlib Authors.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

-->

# Lint

> Lint file license headers.

<section class="usage">

## Usage

```javascript
var lint = require( '@stdlib/_tools/lint/file-license-header' );
```

#### lint( \[options,] clbk )

Asynchronously lints file license headers.

<!-- FIXME: consider enabling. Reason disabled is due to very long run times. -->

<!-- run-disable -->

```javascript
lint( onLint );

function onLint( error, errs ) {
    if ( error ) {
        throw error;
    }
    console.error( JSON.stringify( errs ) );
}
```

The function accepts the following `options`:

-   **header**: license header to lint against. May be a `string`, [regular expression][mdn-regexp], or an `object` mapping license header `strings` and/or [regular expressions][mdn-regexp] to specific file extensions.
-   **dir**: root directory from which to search for files. May be either an absolute or relative directory path. Default: current working directory.
-   **pattern**: filename pattern. Default: `'**/*'`.
-   **ignore**: list of glob patterns used to exclude matches.

To search from a specific directory, set the `dir` option.

```javascript
var opts = {
    'dir': __dirname
};

lint( opts, onLint );

function onLint( error, errs ) {
    if ( error ) {
        throw error;
    }
    console.error( JSON.stringify( errs ) );
}
```

To limit the file search to a subset of files, set the `pattern` option.

```javascript
var opts = {
    'dir': __dirname,
    'pattern': '**/*.js' // JavaScript files
};

lint( opts, onLint );

function onLint( error, errs ) {
    if ( error ) {
        throw error;
    }
    console.error( JSON.stringify( errs ) );
}
```

To exclude matches, set the `ignore` option.

```javascript
var opts = {
    'pattern': '**/*.jl',
    'ignore': [
        'node_modules/**',
        'build/**',
        'reports/**'
    ]
};

lint( opts, onLint );

function onLint( error, errs ) {
    if ( error ) {
        throw error;
    }
    console.error( JSON.stringify( errs ) );
}
```

To lint against a particular license header, set the `header` option.

```javascript
var opts = {
    'dir': __dirname,
    'pattern': '**/*.js',
    'header': '// This file is a part of stdlib. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0'
};

lint( opts, onLint );

function onLint( error, errs ) {
    if ( error ) {
        throw error;
    }
    console.error( JSON.stringify( errs ) );
}
```

The function supports providing a license header [regular expression][mdn-regexp].

```javascript
var opts = {
    'dir': __dirname,
    'pattern': '**/*.js',
    'header': /\/\/ This file is a part of stdlib\. License is Apache-2\.0: http:\/\/www\.apache\.org\/licenses\/LICENSE-2\.0/
};

lint( opts, onLint );

function onLint( error, errs ) {
    if ( error ) {
        throw error;
    }
    console.error( JSON.stringify( errs ) );
}
```

The function supports providing an `object` mapping license header `strings` and/or [regular expressions][mdn-regexp] to specific file extensions.

```javascript
var opts = {
    'dir': __dirname,
    'header': {
        // JavaScript files:
        'js': '// This file is a part of stdlib. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0',

        // Julia files:
        'jl': '# This file is a part of stdlib. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0',

        // Everything else:
        'default': /\/\* This file is a part of stdlib\. License is Apache-2\.0: http:\/\/www\.apache\.org\/licenses\/LICENSE-2\.0 \*\//
    }
};

lint( opts, onLint );

function onLint( error, errs ) {
    if ( error ) {
        throw error;
    }
    console.error( JSON.stringify( errs ) );
}
```

If a provided `header` option object includes a `default` property, the value assigned to that property is used to lint **all** other non-ignored files having file extensions **not** explicitly included in the object; otherwise, the function **ignores** any file **not** having a file extension explicitly included in the object.

#### lint.sync( \[options] )

Synchronously lints file license headers.

```javascript
var errs = lint.sync();
// returns [...]
```

The function accepts the same `options` as `lint()` above.

</section>

<!-- /.usage -->

<section class="notes">

## Notes

-   By default, both functions lint against an Apache-2.0 [license header][@stdlib/_tools/licenses/header].

-   The linter considers the presence of more than one license header in a file a lint error.

-   License headers are expected to begin within the first **5** lines of a file. If a license header begins elsewhere in a file, the linter considers this a lint error.

-   If all files are valid, the returned result is an empty `array`.

-   Each failure is returned as an `object` with the following properties:

    -   **name**: filename.
    -   **error**: reason for failure.

    ```text
    {
        "name": "path/to/failing/file.abc",
        "error": "missing license header."
    }
    ```

-   Only files which fail are returned.

</section>

<!-- /.notes -->

<section class="examples">

## Examples

<!-- eslint no-undef: "error" -->

```javascript
var lint = require( '@stdlib/_tools/lint/file-license-header' );

var opts = {
    'dir': __dirname
};

lint( opts, onLint );

function onLint( error, errs ) {
    if ( error ) {
        throw error;
    }
    console.error( JSON.stringify( errs ) );
}
```

</section>

<!-- /.examples -->

* * *

<section class="cli">

## CLI

<section class="usage">

### Usage

```text
Usage: lint-license-header [options] [<dir>]

Options:

  -h, --help             Print this message.
  -V, --version          Print the package version.
      --pattern pattern  Inclusion glob pattern.
      --ignore pattern   Exclusion glob pattern.
      --split sep        Separator used to split stdin data. Default: /\\r?\\n/.
      --header license   License header.
```

</section>

<!-- /.usage -->

<section class="notes">

### Notes

-   Files which fail are printed to `stderr` as newline-delimited JSON ([NDJSON][ndjson]).

-   If not provided a `dir` argument, the current working directory is the search directory.

-   To provide multiple exclusion glob patterns, set multiple `--ignore` option arguments.

    <!-- run-disable -->

    ```bash
    $ lint-license-header --ignore=node_modules/** --ignore=build/** --ignore=reports/**
    ```

-   To provide multiple license headers, set multiple `--header` option arguments, where each argument value **must** include a file extension prefix. For example,

    <!-- run-disable -->

    ```bash
    $ lint-license-header --header='awk:beep' --header='js:boop' --header='default:foo'
    ```

-   If either the `split` separator or (non-prefixed) `header` is a [regular expression][mdn-regexp], ensure that the option is properly **escaped**.

    <!-- run-disable -->

    ```bash
    # Not escaped...
    $ <stdout> | lint-license-header --split /\r?\n/

    # Escaped...
    $ <stdout> | lint-license-header --split /\\r?\\n/
    ```

</section>

<!-- /.notes -->

<section class="examples">

### Examples

<!-- FIXME: consider enabling. Currently disabled due to very long run times -->

<!-- run-disable -->

```bash
$ lint-license-header
```

To use as part of a [standard stream][standard-stream] pipeline,

<!-- run-disable -->

```bash
$ echo -n $'beep.js\ta/b/c.md\tboop.js' | lint-license-header --split /\\t/
```

</section>

<!-- /.examples -->

</section>

<!-- /.cli -->

<section class="links">

[ndjson]: http://ndjson.org/

[mdn-regexp]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions

[standard-stream]: http://en.wikipedia.org/wiki/Pipeline_%28Unix%29

[@stdlib/_tools/licenses/header]: https://github.com/stdlib-js/stdlib

</section>

<!-- /.links -->
