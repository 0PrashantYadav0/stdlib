var resolve = require( 'path' ).resolve;
var proxyquire = require( 'proxyquire' );

var fpath = resolve( __dirname, '..', 'bin', 'cli' );

process.argv.push( fpath );
process.argv.push( '--protocol=http' );

proxyquire( fpath, {
	'./../lib': get
});

function get( opts, clbk ) {
	var out = {
		'protocol': opts.protocol
	}
	setTimeout( onTimeout, 0 );

	function onTimeout() {
		clbk( null, out );
	}
}
