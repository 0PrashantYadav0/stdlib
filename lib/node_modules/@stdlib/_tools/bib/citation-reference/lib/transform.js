'use strict';

// MODULES //

var replace = require( '@stdlib/string/replace' );


// VARIABLES //

var SMART_DOUBLE_QUOTES = /[\u201C\u201D\u201E\u201F]/g;
var SMART_SINGLE_QUOTES = /[\u2018\u2019\u201A\u201B]/g;
var ITALIC_START = / \*/g;
var ITALIC_END = /\* /g;
var BOLD_START = / __/g;
var BOLD_END = /__ /g;
var TMP_START = /{{REPLACE_ITALIC_START}}/g;
var TMP_END = /{{REPLACE_ITALIC_END}}/g;


// MAIN //

/**
* Transforms raw reference output.
*
* @private
* @param {string} raw - raw output
* @returns {string} transformed output
*
* @example
* var raw = 'Bays, Carter, and S. D. Durham. 1976. “Improving a Poor Random Number Generator.” *ACM Trans. Math. Softw.* 2 (1). New York, NY, USA: ACM: 59–64. doi:[10.1145/355666.355670](http://dx.doi.org/10.1145/355666.355670).'
*
* var out = transform( raw );
* // returns 'Bays, Carter, and S. D. Durham. 1976. "Improving a Poor Random Number Generator." _ACM Trans. Math. Softw._ 2 (1). New York, NY, USA: ACM: 59–64. doi:[10.1145/355666.355670](http://dx.doi.org/10.1145/355666.355670).'
*/
function transform( raw ) {
	raw = replace( raw, SMART_SINGLE_QUOTES, '\'' );
	raw = replace( raw, SMART_DOUBLE_QUOTES, '"' );

	// Replace `*` markers indicating emphasis with a temporary place holder:
	raw = replace( raw, ITALIC_START, '{{REPLACE_ITALIC_START}}' );
	raw = replace( raw, ITALIC_END, '{{REPLACE_ITALIC_END}}' );

	// Replace `__` markers indicating strong with `**`:
	raw = replace( raw, BOLD_START, ' **' );
	raw = replace( raw, BOLD_END, '** ' );

	// Replace temporary place holders with `_` to indicate emphasis:
	raw = replace( raw, TMP_START, ' _' );
	raw = replace( raw, TMP_END, '_ ' );

	return raw;
} // end FUNCTION transform()


// EXPORTS //

module.exports = transform;
