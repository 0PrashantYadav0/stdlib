<!--

@license Apache-2.0

Copyright (c) 2019 The Stdlib Authors.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

-->

# REPL

> Read-Eval-Print Loop (REPL) environment.

<!-- Section to include introductory text. Make sure to keep an empty line after the intro `section` element and another before the `/section` close. -->

<section class="intro">

A Read-Eval-Print Loop (REPL) environment is an interactive programming environment which takes individual user inputs (e.g., single expressions), evaluates those inputs, and returns the result. Accordingly, a program written in a REPL environment is executed piecewise and sequentially.

REPL environments find common use in exploratory programming, prototyping, and debugging.

The REPL environment exposed here is available both as a standalone application and as a library which is embeddable in other libraries and applications.

</section>

<!-- /.intro -->

<!-- Package usage documentation. -->

<section class="usage">

## Usage

```javascript
var REPL = require( '@stdlib/repl/ctor' );
```

#### REPL( \[options] )

Returns a `REPL` instance.

```javascript
// Create a new REPL:
var repl = new REPL();

// ...

// Close the REPL:
repl.close();
```

The function accepts the following `options`:

-   **input**: input (readable) stream. Default: [`stdin`][@stdlib/streams/node/stdin].
-   **output**: output (writable) stream. Default: [`stdout`][@stdlib/streams/node/stdout].
-   **sandbox**: `boolean` indicating whether to run a REPL in a sandboxed context. Default: `false`.
-   **timeout**: number of milliseconds to execute a command before terminating execution. Default: `4294967295`.
-   **isTTY**: `boolean` indicating whether the input and output streams should be treated like a TTY (terminal) and whether the REPL should use ANSI/VT100 escape codes when writing to the output stream.
-   **inputPrompt**: input prompt. If the input prompt includes the character sequence `%d`, the input prompt includes line numbers. Default: `'In [%d]: '`.
-   **outputPrompt**: output prompt. If the output prompt includes the character sequence `%d`, the output prompt includes line numbers. Default: `'Out[%d]: '`.
-   **welcome**: welcome message.
-   **padding**: number of empty lines between consecutive commands. Default: `1`.
-   **load**: file path specifying a JavaScript file to load and evaluate line-by-line (e.g., a previous REPL history file).
-   **save**: file path specifying where to save REPL command history.
-   **log**: file path specifying where to save REPL commands and printed output.
-   **quiet**: `boolean` indicating whether log information, confirmation messages, and other possible REPL diagnostics should be silenced. Default: `false`.

#### REPL.prototype.createContext()

Returns a REPL context.

```javascript
var debug = require( '@stdlib/streams/node/debug-sink' );

function onExit() {
    console.log( 'REPL closed.' );
}

// Create a new REPL:
var repl = new REPL({
    'output': debug()
});
repl.on( 'exit', onExit );

// ...

// Return a new REPL context:
var ctx = repl.createContext();

// ...

// Close the REPL:
repl.close();
```

#### REPL.prototype.resetContext()

Resets a REPL's execution context.

```javascript
var debug = require( '@stdlib/streams/node/debug-sink' );

function onExit() {
    console.log( 'REPL closed.' );
}

// Create a new REPL:
var repl = new REPL({
    'output': debug()
});
repl.on( 'exit', onExit );

// ...

// Reset the REPL context:
repl.resetContext();

// ...

// Close the REPL:
repl.close();
```

#### REPL.prototype.clearHistory()

Clears a REPL's history.

```javascript
var debug = require( '@stdlib/streams/node/debug-sink' );

function onExit() {
    console.log( 'REPL closed.' );
}

// Create a new REPL:
var repl = new REPL({
    'output': debug()
});
repl.on( 'exit', onExit );

// ...

// Clear the REPL history:
repl.clearHistory();

// ...

// Close the REPL:
repl.close();
```

#### Repl.prototype.clearUserDocs()

Clears user-defined documentation.

```javascript
var debug = require( '@stdlib/streams/node/debug-sink' );

function onExit() {
    console.log( 'REPL closed.' );
}

// Create a new REPL:
var repl = new REPL({
    'output': debug()
});
repl.on( 'exit', onExit );

// ...

// Clear user-defined documentation:
repl.clearUserDocs();

// ...

// Close the REPL:
repl.close();
```

#### REPL.prototype.load( fpath, clbk )

Loads and evaluates a JavaScript file line-by-line.

```javascript
var join = require( 'path' ).join;
var debug = require( '@stdlib/streams/node/debug-sink' );

function onExit() {
    console.log( 'REPL closed.' );
}

// Create a new REPL:
var repl = new REPL({
    'output': debug()
});
repl.on( 'exit', onExit );

// ...

// Load and evaluate a file line-by-line:
repl.load( join( __dirname, 'examples', 'history.txt' ), done );

function done() {
    // Close the REPL:
    repl.close();
}
```

#### REPL.prototype.reset()

Resets a REPL.

```javascript
var debug = require( '@stdlib/streams/node/debug-sink' );

function onExit() {
    console.log( 'REPL closed.' );
}

// Create a new REPL:
var repl = new REPL({
    'output': debug()
});
repl.on( 'exit', onExit );

// ...

// Reset the REPL:
repl.reset();

// ...

// Close the REPL:
repl.close();
```

#### REPL.prototype.clear()

Clears the entire REPL screen and scrollback history.

```javascript
var debug = require( '@stdlib/streams/node/debug-sink' );

function onExit() {
    console.log( 'REPL closed.' );
}

// Create a new REPL:
var repl = new REPL({
    'output': debug()
});
repl.on( 'exit', onExit );

// ...

// Clear the REPL:
repl.clear();

// ...

// Close the REPL:
repl.close();
```

This method is **only** applicable for TTY REPLs. In non-TTY REPLs, this method is a non-operation.

#### REPL.prototype.clearLine()

Clears the current line.

```javascript
var debug = require( '@stdlib/streams/node/debug-sink' );

function onExit() {
    console.log( 'REPL closed.' );
}

// Create a new REPL:
var repl = new REPL({
    'output': debug()
});
repl.on( 'exit', onExit );

// ...

// Clear the current line:
repl.clearLine();

// ...

// Close the REPL:
repl.close();
```

This method is **only** applicable for TTY REPLs. In non-TTY REPLs, this method is a non-operation.

#### REPL.prototype.clearCommand()

Clears the current REPL command buffer (i.e., clear any command which has been buffered but not yet executed).

```javascript
var debug = require( '@stdlib/streams/node/debug-sink' );

function onExit() {
    console.log( 'REPL closed.' );
}

// Create a new REPL:
var repl = new REPL({
    'output': debug()
});
repl.on( 'exit', onExit );

// ...

// Clear the command buffer:
repl.clearCommand();

// ...

// Close the REPL:
repl.close();
```

#### REPL.prototype.close()

Closes a REPL.

```javascript
var debug = require( '@stdlib/streams/node/debug-sink' );

function onExit() {
    console.log( 'REPL closed.' );
}

// Create a new REPL:
var repl = new REPL({
    'output': debug()
});
repl.on( 'exit', onExit );

// ...

// Close the REPL:
repl.close();
```

* * *

### Commands

REPL instances support the following commands...

#### alias2pkg( arg )

Returns the package name associated with a provided alias or class instance.

```text
In [1]: var v = alias2pkg( 'base.sin' )
Out[1]: '@stdlib/math/base/special/sin'
```

**Note**: only direct instances of documented built-in constructors are supported.

#### alias2related( arg )

Returns aliases related to a specified alias or class instance.

```text
In [1]: var v = alias2related( 'base.sin' )
Out[1]: [...]
```

**Note**: only direct instances of documented built-in constructors are supported.

#### ans

Result of the last successfully executed command.

```text
In [1]: identity( 3.14 )
Out[1]: 3.14

In [2]: ans
Out[2]: 3.14
```

#### assignfrom( workspace, variable )

Reads a value from a specified `workspace`.

```text
In [1]: workspace( 'foobar' );

In [2]: var x = 3.14;

In [3]: workspace( 'barfoo' );

In [4]: var y = assignfrom( 'foobar', 'x' )
Out[4]: 3.14
```

#### assignin( workspace, variable, value )

Assigns a `value` to a `variable` in a specified `workspace`.

```text
In [1]: assignin( 'base', 'x', 3.14 );

In [2]: x
Out[2]: 3.14
```

#### clear()

Clears the entire REPL screen and scrollback history.

```text
In [1]: clear()
```

**Note**: this function is only applicable for TTY REPLs. In non-TTY REPLs, this function is a non-operation.

#### clearHistory()

Clears the REPL history.

```text
In [1]: clearHistory()
```

#### clearUserDocs( \[options] )

Deletes user-defined documentation.

```text
In [1]: clearUserDocs()
```

The function supports the following `options`:

-   **include**: inclusion filter. May be either an array-like `object` or a regular expression.

-   **exclude**: exclusion filter. May be either an array-like `object` or a regular expression.

-   **filter**: filter type. This option is only applicable for array-like `object` filters. Must be one of the following values:

    -   `'alias'`: filter based on documentation alias. If a filter matches a documentation alias, the user-defined documentation is removed.
    -   `'value'`: filter based on object reference. If a filter matches an associated object reference, the user-defined documentation is removed.
    -   `'*'`: filter based on both documentation alias and object reference. If a filter matches either a documentation alias or an associated object reference, the user-defined documentation is removed.

    Default: `'*'`.

```text
In [1]: clearUserDocs( { 'include': /^foo/ } )
```

#### clearvars( \[options] )

Deletes user-defined variables in the current workspace.

```text
In [1]: clearvars()
```

The function supports the following `options`:

-   **include**: variable name inclusion filter. May be either an array-like `object` or a regular expression.
-   **exclude**: variable name exclusion filter. May be either an array-like `object` or a regular expression.

```text
In [1]: clearvars( { 'include': /^foo/ } )
```

#### clearWorkspace( \[name, ]\[options] )

Deletes user-defined variables in a specified workspace.

```text
In [1]: clearWorkspace()
```

By default, the function clears user-defined variables in the current workspace. To clear user-defined variables in a different workspace, provide a workspace `name`.

```text
// Create a new workspace:
In [1]: workspace( 'foobar' );

In [2]: var x = 3.14;

// Switch to another workspace:
In [3]: workspace( 'barfoo' );

In [4]: typeof x
Out[4]: 'undefined'

// List the variables in the previous workspace:
In [5]: varsWorkspace( 'foobar' )
Out[5]: [ 'x' ]

// Delete the variables in the previous workspace:
In [6]: clearWorkspace( 'foobar' );

In [7]: varsWorkspace( 'foobar' )
Out[7]: []

// Navigate to the previous workspace:
In [8]: workspace( 'foobar' );

// Confirm that the variables were deleted:
In [9]: x
Error: x is not defined
```

The function supports the following `options`:

-   **include**: variable name inclusion filter. May be either an array-like `object` or a regular expression.
-   **exclude**: variable name exclusion filter. May be either an array-like `object` or a regular expression.

```text
In [1]: clearWorkspace( 'foobar', { 'include': /^x/ } );
```

#### currentWorkspace

Returns the name of the current workspace.

```text
In [1]: currentWorkspace
Out[1]: 'base'
```

#### deleteWorkspace( \[name] )

Deletes a workspace.

```text
In [1]: workspace( 'foobar' );

In [2]: var x = 3.14;

In [3]: workspace( 'barfoo' );

In [4]: workspaces()
Out[4]: [ 'base', 'foobar', 'barfoo' ]

In [5]: deleteWorkspace( 'foobar' );

In [6]: workspaces()
Out[6]: [ 'base', 'barfoo' ]
```

If not provided an argument, the REPL deletes the current workspace and switches to the `'base'` workspace.

```text
In [1]: workspace( 'foobar' );

In [2]: currentWorkspace
Out[2]: 'foobar'

In [3]: deleteWorkspace();

In [4]: workspaces()
Out[4]: [ 'base' ]

In [5]: currentWorkspace
Out[5]: 'base'
```

**Note**: the `'base'` workspace **cannot** be deleted.

#### evalin( workspace, expression )

Evaluates an `expression` in a specified `workspace`.

```text
// Create a workspace:
In [1]: workspace( 'foobar' );

// Create and switch to another workspace:
In [2]: workspace( 'barfoo' );

// Attempt to evaluate an expression in the first workspace:
In [3]: evalin( 'foobar', 'var x = 3.14;' );

// Check that nothing has changed in the current workspace:
In [4]: x
Error: x is not defined

// Switch to the first workspace:
In [5]: workspace( 'foobar' );

// Check that the expression was successfully evaluated:
In [6]: x
Out[6]: 3.14
```

#### example( arg )

Runs examples for a specified alias, property, or class instance.

```text
In [1]: example( base.sin )
```

**Note**: only direct instances of documented built-in constructors are supported.

#### help( \[arg] )

Prints help text.

```text
In [1]: help()
```

To print help text for an alias,

```text
In [1]: help( 'base.sin' )

In [2]: help( base.sin )
```

To print help text for a property,

```text
In [1]: help( random.streams.randu.factory )
```

To print help text for a class instance,

```text
In [1]: var x = new Float64Array( 10 );

In [2]: help( x )
```

**Note**: only direct instances of documented built-in constructors are supported.

#### info( arg )

Prints abbreviated help text for a provided alias, property, or class instance.

```text
In [1]: info( base.sin )

In [2]: info( 'base.sin' )
```

**Note**: only direct instances of documented built-in constructors are supported.

#### isKeyword( keyword )

Returns a `boolean` indicating whether a string is a reserved keyword in the REPL environment.

```text
In [1]: isKeyword( 'base.sin' )
Out[1]: true
```

#### load( fpath )

Loads and evaluates a JavaScript file, such as a REPL history file, line-by-line.

```text
In [1]: load( './path/to/file.js' )
```

#### loadWorkspace( name\[, options] )

Loads variables from a specified workspace into the current workspace.

```text
// TODO
```

The function supports the following `options`:

-   **include**: variable name inclusion filter. May be either an array-like `object` or a regular expression.
-   **exclude**: variable name exclusion filter. May be either an array-like `object` or a regular expression.
-   **override**: `boolean` indicating whether to override existing workspace variables. Default: `true`.

```text
// TODO
```

#### logStart( fpath )

Starts logging commands and printed output to a specified file path.

```text
// TODO
```

#### logStop( id )

Stops logging commands and printed output to a file path associated with a specified record identifier.

```text
// TODO
```

#### quit()

Exits the REPL.

```text
// TODO
```

#### renameWorkspace( oldName, newName )

Renames a workspace.

```text
// TODO
```

**Note**: the new workspace name must **not** already exist. The only exception is when the old name and the new name are the same; in which case, invoking this command is a non-operation.

**Note**: as a `'base'` workspace must **always** exist, when renaming the `'base'` workspace, variables from the `'base'` workspace are simply copied to a new workspace and the `'base'` workspace cleared of user-defined variables.

#### require( id )

Imports a module, JSON, or local file.

```text
In [1]: var crypto = require( 'crypto' );
```

Modules can be imported from `node_modules`. Local modules and JSON files can be imported using a relative path (e.g., `'./foo.js'`, `'./../bar.json'`, etc) that will be resolved against the current working directory.

#### rerequire( id )

Re-imports a module, JSON, or local file.

```text
In [1]: var foo = require( './foo.js' );

// Modify `./foo.js`...

// Re-import the module:
In [2]: foo = rerequire( './foo.js' );
```

Modules can be imported from `node_modules`. Local modules and JSON files can be imported using a relative path (e.g., `'./foo.js'`, `'./../bar.json'`, etc) that will be resolved against the current working directory.

#### rerun( \[arg] )

Reruns previous commands.

```text
// TODO
```

By default, the command re-executes the previous command. If provided an `integer`, the previous `n` commands are re-executed.

```text
// TODO
```

If provided a regular expression, the most recent command matching the regular expression is rerun.

```text
// TODO
```

If provided an `array` of command identifiers, the command corresponding to each identifier is rerun.

```text
// TODO
```

If provided a subsequence `string`, the command corresponding to each resolved command identifier is rerun.

```text
// TODO
```

**WARNING**: be careful when re-evaluating previously executed `rerun` commands, as this can lead to infinite execution loops.

#### reset()

Resets the REPL.

```text
// TODO
```

#### save( fpath )

Saves previous commands to a specified file path.

```text
// TODO
```

#### saveStart( fpath )

Starts saving commands to a specified file path.

```text
// TODO
```

#### saveStop( id )

Stops saving commands to a file path associated with a specified record identifier.

```text
// TODO
```

#### userDoc( alias, \[ref,] doc )

Adds user-defined documentation.

```text
// TODO
```

If user-defined documentation already exists for the provided alias, the current documentation is overwritten.

```text
// TODO
```

#### vars( \[options] )

Returns a list of variable names in the current workspace.

```text
// TODO
```

The function supports the following `options`:

-   **include**: regular expression variable name inclusion filter.
-   **exclude**: regular expression variable name exclusion filter.
-   **types**: array-like `object` containing variable type inclusion filter(s).
-   **details**: `boolean` indicating whether to include additional variable details, such as variable type, contents, etc. Default: `false`.

```text
// TODO
```

#### varsWorkspace( \[name, ]\[options] )

Returns a list of variable names in a specified workspace.

```text
// TODO
```

The function supports the following `options`:

-   **include**: regular expression variable name inclusion filter.
-   **exclude**: regular expression variable name exclusion filter.
-   **types**: array-like `object` containing variable type inclusion filter(s).
-   **details**: `boolean` indicating whether to include additional variable details, such as variable type, contents, etc. Default: `false`.

```text
// TODO
```

#### workspace( name )

Switch to a specified workspace.

```text
// TODO
```

If a workspace with the specified `name` does not exist, the workspace is created.

```text
// TODO
```

#### workspaces( \[options] )

Returns a list of workspace names.

```text
// TODO
```

The function supports the following `options`:

-   **include**: regular expression workspace name inclusion filter.
-   **exclude**: regular expression workspace name exclusion filter.
-   **details**: `boolean` indicating whether to include additional workspace details, such as variable names, types, contents, etc. Default: `false`.

```text
// TODO
```

</section>

<!-- /.usage -->

<!-- Package usage notes. Make sure to keep an empty line after the `section` element and another before the `/section` close. -->

<section class="notes">

</section>

<!-- /.notes -->

<!-- Package usage examples. -->

* * *

<section class="examples">

## Examples

<!-- eslint no-undef: "error" -->

```javascript
var join = require( 'path' ).join;
var REPL = require( '@stdlib/repl/ctor' );

function onExit() {
    console.log( '' );
    console.log( 'REPL closed.' );
}

// Create a new REPL:
var repl = new REPL();
repl.on( 'exit', onExit );

// Load a history file:
repl.load( join( __dirname, 'examples', 'history.txt' ) );

// Close the REPL:
repl.close();
```

</section>

<!-- /.examples -->

<!-- Section for describing a command-line interface. -->

* * *

<section class="cli">

## CLI

<!-- CLI usage documentation. -->

<section class="usage">

### Usage

```text
Usage: stdlib-repl [options]

Options:

  -h, --help                    Print this message.
  -V, --version                 Print the package version.
      --welcome <message>       Welcome message.
      --input_prompt <prompt>   Input prompt. Default: 'In [%d]: '.
      --output_prompt <prompt>  Output prompt. Default: 'Out[%d]: '.
      --padding <padding>       Empty lines between commands. Default: 1.
      --load <filepath>         JavaScript file to evaluate line-by-line.
      --save <filepath>         File to save REPL command history.
      --logfile <filepath>      File to log REPL commands and printed output.
      --timeout <timeout>       Milliseconds before terminating a command.
      --quiet                   Disable printing of REPL logs and diagnostics.
```

</section>

<!-- /.usage -->

<!-- CLI usage notes. Make sure to keep an empty line after the `section` element and another before the `/section` close. -->

<section class="notes">

</section>

<!-- /.notes -->

<!-- CLI usage examples. -->

<section class="examples">

### Examples

```bash
$ stdlib-repl
```

</section>

<!-- /.examples -->

</section>

<!-- /.cli -->

<!-- Section to include cited references. If references are included, add a horizontal rule *before* the section. Make sure to keep an empty line after the `section` element and another before the `/section` close. -->

<section class="references">

</section>

<!-- /.references -->

<!-- Section for all links. Make sure to keep an empty line after the `section` element and another before the `/section` close. -->

<section class="links">

[@stdlib/streams/node/stdin]: https://github.com/stdlib-js/stdlib

[@stdlib/streams/node/stdout]: https://github.com/stdlib-js/stdlib

</section>

<!-- /.links -->
