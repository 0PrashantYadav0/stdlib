/**
* @license Apache-2.0
*
* Copyright (c) 2019 The Stdlib Authors.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*    http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/

/* eslint-disable no-underscore-dangle */

'use strict';

// MODULES //

var logger = require( 'debug' );
var createContext = require( './create_context.js' );
var displayPrompt = require( './display_prompt.js' );


// VARIABLES //

var debug = logger( 'repl:clear' );


// MAIN //

/**
* Clears a REPL's local context.
*
* @private
* @param {REPL} repl - REPL instance
*/
function clear( repl ) {
	debug( 'Clearing the local REPL context...' );

	// Clear the command queue:
	repl._queue.clear();

	// Clear any command which has been buffered but not yet executed:
	repl._cmd.length = 0;

	// Clear the command history:
	repl._history.length = 0;

	// When sandboxed, create a new execution context...
	if ( repl._sandbox ) {
		repl._context = createContext( repl );
		repl.emit( 'reset', repl._context );
	}
	// Clear an output TTY stream of any previous commands and output:
	if ( repl._isTTY ) {
		/*
		* Clear the entire screen and scrollback history using [ANSI escape sequences][1].
		*
		* -   `\u001b`: ESC, the escape character
		* -   `[H`: move cursor to upper left corner
		* -   `[2J`: clear the entire screen
		* -   `[3J`: clear the entire screen and delete all lines in the scrollback buffer (note: possible portability issues)
		*
		* [1]: https://en.wikipedia.org/wiki/ANSI_escape_code
		*/
		repl._ostream.write( '\u001b[2J\u001b[H\u001b[2J\u001b[3J' );
	}
	// Display the command prompt:
	displayPrompt( repl, false );
}


// EXPORTS //

module.exports = clear;
