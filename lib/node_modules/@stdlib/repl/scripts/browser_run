#!/usr/bin/env node
'use strict';

// MODULES //

var debug = require( 'debug' )( 'repl:browser-run' );
var resolve = require( 'path' ).resolve;
var browserify = require( 'browserify' );
var httpServer = require( '@stdlib/tools/disposable-http-server' );


// VARIABLES //

var fpath = resolve( __dirname, '..', 'lib', 'browser.js' );


// MAIN //

/**
* Main execution sequence.
*
* @private
*/
function main() {
	var b = browserify( [ fpath ], {} );

	debug( 'Creating a bundle...' );
	b.bundle( onBundle );

	/**
	* Callback invoked upon creating a bundle.
	*
	* @private
	* @param {(Error|null)} error - error object
	* @param {Buffer} bundle - bundle
	* @returns {void}
	*/
	function onBundle( error, bundle ) {
		var opts;
		if ( error ) {
			debug( 'Encountered an error when creating a bundle: %s', error.message );
			return;
		}
		debug( 'Successfully created a bundle.' );

		debug( 'Sending bundle to browser...' );
		opts = {
			'javascript': bundle,
			'open': true
		};
		httpServer( opts );
	} // end FUNCTION onBundle()
} // end FUNCTION main()

main();
