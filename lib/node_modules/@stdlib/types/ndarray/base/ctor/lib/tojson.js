'use strict';

// MODULES //

var ind2sub = require( '@stdlib/types/ndarray/base/ind2sub' );


// MAIN //

/**
* Serializes an ndarray as a JSON object.
*
* ## Notes
*
* -   The method does **not** serialize data outside of the buffer region defined by the array shape.
*
* @private
* @returns {Object} JSON representation
*/
function toJSON() {
	/* eslint-disable no-invalid-this */
	var out;
	var len;
	var sub;
	var i;

	// Build an object containing all ndarray properties needed to revive a serialized ndarray...
	out = {};
	out.type = 'ndarray';
	out.dtype = this._dtype;
	out.flags = this._flags; // TODO: reserved for future use
	out.order = this._order;
	out.shape = this._shape.slice();
	out.strides = this._strides.slice();

	// Cast data to generic array...
	len = this._length;
	out.data = [];
	for ( i = 0; i < len; i++ ) {
		sub = ind2sub( this._shape, this._strides, this._offset, this._order, i, 'throw' ); // eslint-disable-line max-len
		out.data.push( this.get.apply( this, sub ) ); // TODO: use iget
	}
	return out;
} // end FUNCTION toJSON()


// EXPORTS //

module.exports = toJSON;
