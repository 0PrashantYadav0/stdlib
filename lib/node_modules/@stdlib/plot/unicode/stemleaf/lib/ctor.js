'use strict';

// MODULES //

var xValue = require( './x_value.js' );
var yValue = require( './y_value.js' );
var formatData = require( './format_data.js' );
var validate = require( './validate.js' );


// MAIN //

/**
* Creates a stem-and-leaf plot.
*
* @constructor
* @param {Options} [options] - steam-and-leaf options
* @param {(Array|TypedArray)} [options.x] - first input data
* @param {(Array|TypedArray)} [options.y] - second input data
* @param {Function} [options.xValue] - x-value accessor
* @param {Function} [options.yValue] - y-value accessor
* @param {PositiveInteger} [options.leafDigits=1] - number of digits to display as leafs
* @returns {StemLeaf} chart instance
*/
function StemLeaf( options ) {
	var opts;
	var err;
	if ( !(this instanceof StemLeaf) ) {
		if ( arguments.length ) {
			return new StemLeaf( options );
		}
		return new StemLeaf();
	}
	if ( arguments.length ) {
		opts = options;
		err = validate( opts );
		if ( err ) {
			throw err;
		}
	} else {
		opts = {};
	}

	Object.defineProperty( this, '_x', {
		'configurable': false,
		'enumerable': false,
		'writable': true,
		'value': []
	});
	Object.defineProperty( this, '_xValue', {
		'configurable': false,
		'enumerable': false,
		'writable': true,
		'value': xValue
	});
	Object.defineProperty( this, '_y', {
		'configurable': false,
		'enumerable': false,
		'writable': true,
		'value': []
	});
	Object.defineProperty( this, '_yValue', {
		'configurable': false,
		'enumerable': false,
		'writable': true,
		'value': yValue
	});
	Object.defineProperty( this, '_leafDigits', {
		'configurable': false,
		'enumerable': false,
		'writable': true,
		'value': 1
	});

	if ( opts.xValue !== void 0 ) {
		this._xValue = opts.xValue;
	}
	if ( opts.yValue !== void 0 ) {
		this._yValue = opts.yValue;
	}
	if ( opts.x !== void 0 ) {
		this._x = formatData( opts.x, this._yValue );
	}
	if ( opts.y !== void 0 ) {
		this._y = formatData( opts.y, this._yValue );
	}
	if ( opts.leafDigits !== void 0 ) {
		this._leafDigits = opts.leafDigits;
	}
	return this;
} // end FUNCTION StemLeaf()

/**
* `x`-value accessor.
*
* @memberof StemLeaf.prototype
* @name xValue
* @type {Function}
* @throws {TypeError} must be a function
*
* @example
* function xValue( d ) {
*     return d.y;
* }
* var chart = new StemLeaf();
* chart.xValue = xValue;
*
* @example
* function xValue( d ) {
*     return d.y;
* }
* var chart = new StemLeaf({
*     'xValue': xValue
* });
* var fcn = chart.xValue;
* var bool = ( fcn === xValue );
* // returns true
*/
Object.defineProperty( StemLeaf.prototype, 'xValue', {
	'configurable': false,
	'enumerable': true,
	'set': require( './set_xvalue.js' ),
	'get': require( './get_xvalue.js' )
});

/**
* `y`-value accessor.
*
* @memberof StemLeaf.prototype
* @name yValue
* @type {Function}
* @throws {TypeError} must be a function
*
* @example
* function yValue( d ) {
*     return d.y;
* }
* var chart = new StemLeaf();
* chart.yValue = yValue;
*
* @example
* function yValue( d ) {
*     return d.y;
* }
* var chart = new StemLeaf({
*     'yValue': yValue
* });
* var fcn = chart.yValue;
* var bool = ( fcn === yValue );
* // returns true
*/
Object.defineProperty( StemLeaf.prototype, 'yValue', {
	'configurable': false,
	'enumerable': true,
	'set': require( './set_yvalue.js' ),
	'get': require( './get_yvalue.js' )
});

/**
* First stem-and-leaf data.
*
* @memberof StemLeaf.prototype
* @name x
* @type {(Array|TypedArray)}
* @throws {TypeError} must be an array or typed array
*
* @example
* var chart = new StemLeaf();
* chart.x = [ 1.0, 0.0, 8.0, 2.0, 5.0 ];
*
* @example
* var x = [ 1.0, 0.0, 9.0, 2.0, 5.0 ];
* var chart = new StemLeaf({
*     'x': x
* });
* var d = chart.x;
* // returns [...]
*/
Object.defineProperty( StemLeaf.prototype, 'x', {
	'configurable': false,
	'enumerable': true,
	'set': require( './set_x.js' ),
	'get': require( './get_x.js' )
});

/**
* Second stem-and-leaf data.
*
* @memberof StemLeaf.prototype
* @name y
* @type {(Array|TypedArray)}
* @throws {TypeError} must be an array or typed array
*
* @example
* var chart = new StemLeaf();
* chart.y = [ 1.0, 0.0, 8.0, 2.0, 5.0 ];
*
* @example
* var y = [ 1.0, 0.0, 9.0, 2.0, 5.0 ];
* var chart = new StemLeaf({
*     'y': y
* });
* var d = chart.y;
* // returns [...]
*/
Object.defineProperty( StemLeaf.prototype, 'y', {
	'configurable': false,
	'enumerable': true,
	'set': require( './set_y.js' ),
	'get': require( './get_y.js' )
});

/**
* Renders a stem-and-leaf plot
*
* @memberof StemLeaf.prototype
* @function render
* @returns {string} rendered stem-and-leaf display
*/
StemLeaf.prototype.render = require( './render.js' );


// EXPORTS //

module.exports = StemLeaf;
