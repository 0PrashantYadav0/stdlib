'use strict';

// MODULES //

var debug = require( 'debug' )( 'plot:render:svg:marks' );
var Path = require( '@stdlib/plot/components/svg/path' );
var Symbols = require( '@stdlib/plot/components/svg/symbols' );


// RENDER //

/**
* Renders individual marks.
*
* @private
* @param {Object} state - state
* @returns {VTree} virtual tree
*/
function render( state ) {
	var lineStyles;
	var lineStyle;
	var numStyles;
	var numColors;
	var numSyms;
	var symbol;
	var parent;
	var line;
	var sym;
	var len;
	var i;
	var j;

	debug( 'Rendering marks group...' );
	parent = state.$.svg.marks.render();

	len = state.x.length;
	if ( len === 0 ) {
		debug( 'No individual marks to render.' );
		return parent;
	}
	lineStyles = [ '-' ]; //state.lineStyles; FIXME

	numStyles = lineStyles.length; // FIXME: once state.lineStyles
	numColors = state.colors.length;
	numSyms = state.symbols.length;

	debug( 'Rendering individual marks...' );
	for ( i = 0; i < len; i++ ) {
		line = null;
		sym = null;

		j = i + 1;
		debug( 'Rendering data %d of %d...', j, len );

		lineStyle = lineStyles[ i%numStyles ]; // FIXME: once state.lineStyles
		debug( 'Line style: %s (%d).', lineStyle, j );

		// Lines...
		if ( lineStyle === '-' ) {
			debug( 'Rendering data as a line (%d)...', j );
			line = new Path({
				'x': state.x[ i ],
				'y': state.y[ i ],
				'xScale': state.xScale,
				'yScale': state.yScale,
				'isDefined': state.isDefined,
				'label': state.labels[ i ] || '',
				'color': state.colors[ i%numColors ] || '',
				'autoRender': false
			});
			line = line.render();
		}

		symbol = state.symbols[ i%numSyms ];
		debug( 'Symbol: %s (%d).', symbol, j );

		// Symbols...
		if ( symbol !== 'none' ) {
			debug( 'Rendering data as symbols (%d)...', j );
			sym = new Symbols({
				'symbol': symbol,
				'x': state.x[ i ],
				'y': state.y[ i ],
				'xScale': state.xScale,
				'yScale': state.yScale,
				'isDefined': state.isDefined,
				'label': state.labels[ i ] || '',
				'color': state.colors[ i%numColors ] || '',
				'size': state.symbolSize,
				'opacity': state.symbolOpacity,
				'autoRender': false
			});
			sym = sym.render();
		}
		if ( !line && !sym ) {
			debug( 'Unable to render data %d of %d.', j, len );
			continue;
		}
		debug( 'Finished rendering data %d of %d.', j, len );

		debug( 'Inserting data marks (%d) into marks group...', j );
		if ( line ) {
			parent.children.push( line );
			parent.count += line.count;
		}
		if ( sym ) {
			parent.children.push( sym );
			parent.count += sym.count;
		}
	}
	debug( 'Finished rendering marks.' );
	return parent;
} // end FUNCTION render()


// EXPORTS //

module.exports = render;
