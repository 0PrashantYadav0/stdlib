'use strict';

// MODULES //

var isPositiveIntegerArray = require( '@stdlib/utils/is-positive-integer' ).isPositivePrimitiveIntegerArray;
var isObject = require( '@stdlib/utils/is-plain-object' );
var hasOwnProp = require( '@stdlib/utils/has-own-property' );
var copy = require( '@stdlib/utils/copy' );
var isBoolean = require( '@stdlib/utils/is-boolean' ).isPrimitive;
var defaults = require( './defaults.js' );
var genFcn = require( './equal_dims.js' );


// FACTORY //

/**
* Returns a function for flattening arrays having  specified dimensions.
*
* @param {PositiveIntegerArray} dims - dimensions
* @param {Options} [options] - function options
* @param {Boolean} [options.copy=false] - boolean indicating whether to deep copy array elements
* @throws {TypeError} first argument must be an array of positive integers
* @throws {TypeError} options argument must be an object
* @throws {TypeError} must provide valid options
* @returns {Function} flatten function
*
* @example
* var flatten = factory( [2,2], {
*     'copy': false
* });
*
* var out = flatten( [[1,2],[3,4]] );
* // returns [ 1, 2, 3, 4 ]
*/
function factory( dims, options ) {
	var copyFLG;
	var f;
	if ( !isPositiveIntegerArray( dims ) ) {
		throw new TypeError( 'invalid input argument. First argument must be an array of positive integers. Value: `' + dims + '`.' );
	}
	copyFLG = defaults.copy;
	if ( arguments.length > 1 ) {
		if ( !isObject( options ) ) {
			throw new TypeError( 'invalid input argument. Options argument must be an object. Value: `' + options + '`.' );
		}
		if ( hasOwnProp( options, 'copy' ) ) {
			copyFLG = options.copy;
			if ( !isBoolean( copyFLG ) ) {
				throw new TypeError( 'invalid option. `copy` option must be a boolean primitive. Option: `' + copyFLG + '`.' );
			}
		}
	}
	f = genFcn( dims );
	if ( copyFLG ) {
		return flattenArray;
	}
	return f;

	/**
	* Flattens an array and deep copies array elements.
	*
	* @private
	* @param {Array} arr - array to flatten
	* @returns {Array} flattened array
	*/
	function flattenArray( arr ) {
		return copy( f( arr ) );
	} // end FUNCTION flattenArray()
} // end FUNCTION factory()


// EXPORTS //

module.exports = factory;
