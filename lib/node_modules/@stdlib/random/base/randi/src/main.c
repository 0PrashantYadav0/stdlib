/**
* @license Apache-2.0
*
* Copyright (c) 2018 The Stdlib Authors.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*    http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/

// Note: keep project includes in alphabetical order...
#include <stdlib.h>
#include <stdint.h>
#include "stdlib/random/base.h"
#include "stdlib/random/base/minstd.h"
#include "stdlib/random/base/minstd_shuffle.h"
#include "stdlib/random/base/mt19937.h"
#include "stdlib/random/base/randi.h"

/**
* Returns a pointer to a dynamically allocated PRNG.
*
* ## Notes
*
* -   The user is responsible for freeing the allocated memory.
*
* @param seed  PRNG seed
* @return      pointer to a dynamically allocated PRNG or, if unable to allocate memory, a null pointer
*
* @example
* #include <stdlib.h>
* #include <stdio.h>
* #include <stdint.h>
* #include "stdlib/random/base.h"
* #include "stdlib/random/base/randi.h"
*
* // Define a PRNG type:
* enum STDLIB_BASE_RANDOM_RANDI_PRNG prng = STDLIB_BASE_RANDOM_MINSTD;
*
* // Define a PRNG seed:
* int32_t seed = 12345;
*
* // Create a PRNG:
* struct BasePRNGObject *obj = stdlib_base_random_randi_allocate( prng, (void *)&seed );
* if ( obj == NULL ) {
*     fprintf( stderr, "Error allocating memory.\n" );
*     exit( 1 );
* }
*
* uint64_t r;
* int8_t status = obj->prng->next( obj, &r );
* if ( status != 0 ) {
*     fprintf( stderr, "Unexpected result.\n" );
*     exit( 1 );
* }
*
* // ...
*
* status = obj->prng->next( obj, &r );
*
* // ...
*
* status = obj->prng->next( obj, &r );
*
* // ...
*
* // Free allocated memory:
* stdlib_base_random_randi_free( obj );
*/
struct BasePRNGObject * stdlib_base_random_randi_allocate( const enum STDLIB_BASE_RANDOM_RANDI_PRNG prng, const void *seed ) {
	struct BasePRNGObject *obj;
	if ( prng == STDLIB_BASE_RANDOM_MINSTD ) {
		return stdlib_base_random_minstd_allocate( *(int32_t *)seed );
	}
	if ( prng == STDLIB_BASE_RANDOM_MINSTD_SHUFFLE ) {
		return stdlib_base_random_minstd_shuffle_allocate( *(int32_t *)seed );
	}
	if ( prng == STDLIB_BASE_RANDOM_MT19937 ) {
		return stdlib_base_random_mt19937_allocate( (uint32_t *)seed );
	}
	// How did we get here? A non-implemented PRNG?
	return NULL;
}

/**
* Frees a PRNG's allocated memory.
*
* @param obj  PRNG object
*
* @example
* #include <stdlib.h>
* #include <stdio.h>
* #include <stdint.h>
* #include "stdlib/random/base.h"
* #include "stdlib/random/base/randi.h"
*
* // Define a PRNG type:
* enum STDLIB_BASE_RANDOM_RANDI_PRNG prng = STDLIB_BASE_RANDOM_MINSTD;
*
* // Define a PRNG seed:
* int32_t seed = 12345;
*
* // Create a PRNG:
* struct BasePRNGObject *obj = stdlib_base_random_randi_allocate( prng, (void *)&seed );
* if ( obj == NULL ) {
*     fprintf( stderr, "Error allocating memory.\n" );
*     exit( 1 );
* }
*
* uint64_t r;
* int8_t status = obj->prng->next( obj, &r );
* if ( status != 0 ) {
*     fprintf( stderr, "Unexpected result.\n" );
*     exit( 1 );
* }
*
* // ...
*
* status = obj->prng->next( obj, &r );
*
* // ...
*
* status = obj->prng->next( obj, &r );
*
* // ...
*
* // Free allocated memory:
* stdlib_base_random_randi_free( obj );
*/
void stdlib_base_random_randi_free( struct BasePRNGObject *obj ) {
	if ( obj == NULL ) {
		return;
	}
	obj->prng->free( obj );
}
