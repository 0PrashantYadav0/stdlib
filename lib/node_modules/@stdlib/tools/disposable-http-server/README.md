# Disposable HTTP Server

> Create a disposable HTTP server.

<!-- <usage> -->

## Usage

``` javascript
var httpServer = require( '@stdlib/tools/disposable-http-server' );
```

#### httpServer( options\[, clbk\] )

Creates a disposable HTTP server; i.e., the server closes immediately after serving provided content.

``` javascript
var opts = {
    'html': '<script src="/bundle.js"></script>',
    'javascript': 'console.log( "Boop" );'
};

httpServer( opts );
```

The function accepts the following options:

* __html__: `buffer` or `string` to serve as HTML content.
* __javascript__: `buffer` or `string` to serve as JavaScript.
* __port__: server port. Default: `0` (i.e., randomly assigned).
* __maxport__: max server port (used when port hunting). Default: `=port`.
* __hostname__: server hostname.
* __address__: server address. Default: `"0.0.0.0"`.
* __open__: `boolean` indicating whether to launch a web browser. Default: `false`.

To serve HTML content, set the `html` option. Once the content is requested, the server will close.

``` javascript
var opts = {
    'html': '<h1>Beep</h1>'
};

httpServer( opts );
```

To serve JavaScript, set the `javascript` option. If no HTML is provided, an HTML boilerplate is served and the JavaScript is served as `/bundle.js`. Once the content is requested, the server will close.

``` javascript
var opts = {
    'javascript': 'console.log( "Boop" );'
};

httpServer( opts );
```

If HTML and JavaScript are provided, in order for the JavaScript to be served, the HTML content should request the file `/bundle.js`.

``` javascript
var opts = {
    'html': '<script src="/bundle.js"></script>',
    'javascript': 'console.log( "Boop" );'
};

httpServer( opts );
```

To obtain the `server` handle, provide a callback.

``` javascript
function onReady( error, server ) {
    if ( error ) {
        throw error;
    }
    process.nextTick( close );
    function close() {
        server.close();
    }
}

var opts = {
    'html': html,
    'javascript': 'console.log( "Boop" );'
};

httpServer( opts, onReady );
```

<!-- </usage> -->


<!-- <notes> -->

## Notes

* If neither the `html` or `javascript` option is set, the server serves an HTML boilerplate and then closes.

<!-- </notes> -->


<!-- <examples> -->

## Examples

``` javascript
var path = require( 'path' );
var readFileSync = require( '@stdlib/fs/read-file' ).sync;
var httpServer = require( '@stdlib/tools/disposable-http-server' );

var html = path.join( __dirname, 'fixtures/index.html' );
var js = path.join( __dirname, 'fixtures/script.js' );

var opts = {
    'html': readFileSync( html ),
    'javascript': readFileSync( js ),
    'port': 7331,
    'hostname': 'localhost',
    'open': false
};

httpServer( opts, clbk );

function clbk( error, server ) {
    if ( error ) {
        throw error;
    }
    // Give the user a few seconds to open her web browser before closing the server...
    setTimeout( onTimeout, 5000 );

    function onTimeout() {
        server.close();
    }
}
```

<!-- </examples> -->


---

<!-- <cli> -->

## CLI

<!-- <usage> -->

### Usage

``` bash
Usage: temphttpserver [options] (--html path | --javascript path | --stdin type)

Options:

  -h,    --help                Print this message.
  -V,    --version             Print the package version.
         --html path           Serve HTML.
  --js,  --javascript path     Serve JavaScript.
         --stdin type          Type of content: html or javascript.
  -p,    --port port           Server port. Default: 0.
         --maxport maxport     Max server port. Default: `port`.
         --hostname hostname   Server hostname.
         --address address     Server address. Default: 0.0.0.0.
         --open                Launch a browser once server is ready.
```

The application recognizes the following [environment variables][environment-variable]:

* `DEBUG`: enable verbose logging.
* `PORT`: server port.
* `MAXPORT`: max server port.
* `HOSTNAME`: server hostname.
* `ADDRESS`: server address.


<!-- </usage> -->


<!-- <notes> -->

### Notes

* Command-line arguments __always__ take precedence over [environment variables][environment-variable].
* If either the `--html` or `--javascript` command-line flag is set, `stdin` is assumed to be of the other type. Accordingly, the `--stdin` flag may be omitted.

<!-- </notes> -->


<!-- <examples> -->

### Examples

To serve an HTML file,

``` bash
$ DEBUG=* temphttpserver --html ./examples/fixtures/index.html
...
```

To serve a JavaScript file (and a default HTML boilerplate),

``` bash
$ DEBUG=* temphttpserver --javascript ./examples/fixtures/script.js
...
```

In addition to file input, the application accepts [standard input][standard-streams]. To pipe HTML,

``` bash
$ cat ./examples/fixtures/index.html | DEBUG=* temphttpserver --port 7331 --stdin html
...
```

To pipe HTML and load a JavaScript file,

``` bash
$ cat ./examples/fixtures/index.html | DEBUG=* temphttpserver --port 7331 --javascript ./examples/fixtures/script.js
...
```

To pipe JavaScript (and serve a default HTML boilerplate),

``` bash
$ cat ./examples/fixtures/script.js | DEBUG=* temphttpserver --address '127.0.0.1' --stdin javascript
...
```

To pipe JavaScript and serve custom HTML content which requests a `/bundle.js` file,

``` bash
$ cat ./examples/fixtures/script.js | DEBUG=* temphttpserver --html ./examples/fixtures/index.html
...
```

<!-- </examples> -->

<!-- </cli> -->


<!-- <links> -->

[environment-variable]: https://en.wikipedia.org/wiki/Environment_variable
[standard-streams]: https://en.wikipedia.org/wiki/Standard_streams

<!-- </links> -->
