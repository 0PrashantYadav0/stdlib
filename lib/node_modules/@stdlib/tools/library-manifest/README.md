# Manifest

> Load a manifest for compiling source files.


<!-- Section to include introductory text. Make sure to keep an empty line after the intro `section` element and another before the `/section` close. -->

<section class="intro">

</section>

<!-- /.intro -->

<!-- Package usage documentation. -->

<section class="usage">

## Usage

``` javascript
var manifest = require( '@stdlib/tools/library-manifest' );
```

#### manifest( filepath, conditions\[, options\] )

Loads a manifest for compiling source files.

``` javascript
var conditions = {
    'os': 'linux'
};

var conf = manifest( './manifest.json', conditions );
// returns <Object>
```

The function accepts the following `options`:

* __basedir__: base directory from which to search for dependencies. Default: current working directory.

The default search directory is the current working directory of the calling process. To specify an alternative search directory, set the `basedir` option.

``` javascript
var conditions = {
    'os': 'linux'
};

var opts = {
    'basedir': '/foo/bar/beep/boop'
};

var conf = manifest( './manifest.json', conditions, opts );
// returns <Object>
```

</section>

<!-- /.usage -->

<!-- Package usage notes. Make sure to keep an empty line after the `section` element and another before the `/section` close. -->

<section class="notes">

## Notes

* A *manifest* is a [JSON][json] file having the following fields:

  - __options__: an `object` containing key-value pairs. Each key corresponds to a field in __confs__ and may be use to conditionally select a configuration. Each value corresponds to the key's default value.

  - __fields__: an object `array` where each `object` has the following fields:

    - __field__: key name corresponding to a field in __confs__.
    - __resolve__: `boolean` indicating whether to resolve field values to absolute file paths. If `true`, all field values are resolved relative to the manifest file.

  - __confs__: an object `array` where each `object` corresponds to a manifest configuration. Each `object` has the following fields:

    - __src__: `array` of source files.
    - __include__: `array` of include directories.
    - __libraries__: `array` of linked library dependencies.
    - __libpath__: `array` of linked library paths.
    - __dependencies__: `array` of package dependencies containing source files.

  An example *manifest*:

  ``` javascript
  {
    "options": {
      "os": "linux"
    },
    "fields": [
      {
        "field": "src",
        "resolve": true
      },
      {
        "field": "include",
        "resolve": true
      },
      {
        "field": "libraries",
        "resolve": false
      },
      {
        "field": "libpath",
        "resolve": true
      }
    ],
    "confs": [
      {
        "os": "linux",
        "src": [
          "./src/foo_linux.f",
          "./src/foo_linux.c"
        ],
        "include": [
          "./include"
        ],
        "libraries": [],
        "libpath": [],
        "dependencies": [
          "@stdlib/math/base/blas/daxpy",
          "@stdlib/math/base/blas/dasum",
          "@stdlib/math/base/blas/dcopy"
        ]
      }
    ]
  }   
  ```

* The function recursively walks the manifest dependency tree to resolve __all__ source files, libraries, library paths, and include directories.

* An input `filepath` may be either a relative or absolute file path. If provided a relative file path, a manifest is resolved relative to the base search directory.

</section>

<!-- /.notes -->

<!-- Package usage examples. -->

<section class="examples">

## Examples

``` javascript
var join = require( 'path' ).join;
var manifest = require( '@stdlib/tools/library-manifest' );

// Resolve the absolute path of the manifest JSON file:
var fpath = join( __dirname, 'examples', 'manifest.json' );

// Specify conditions for determining which configuration to load:
var conditions = {
    'os': 'mac'
};

// Specify options:
var opts = {
    'basedir': __dirname
};

// Load a manifest configuration:
var conf = manifest( fpath, conditions, opts );
console.dir( conf );
```

</section>

<!-- /.examples -->


<!-- Section for describing a command-line interface. -->

---

<section class="cli">

## CLI

<!-- CLI usage documentation. -->

<section class="usage">

### Usage

``` bash
Usage: library-manifest [options] <filepath> [-- --<condition>=value ...]

Options:

  -h,    --help                Print this message.
  -V,    --version             Print the package version.
         --dir basedir         Base search directory.
```

</section>

<!-- /.usage -->

<!-- CLI usage notes. Make sure to keep an empty line after the `section` element and another before the `/section` close. -->

<section class="notes">

### Notes

* Use command-line flags to specify conditions by placing them after a `--` separator.

</section>

<!-- /.notes -->

<!-- CLI usage examples. -->

<section class="examples">

### Examples

``` bash
$ library-manifest ./examples/manifest.json -- --os mac
```

</section>

<!-- /.examples -->

</section>

<!-- /.cli -->


<!-- Section to include cited references. If references are included, add a horizontal rule *before* the section. Make sure to keep an empty line after the `section` element and another before the `/section` close. -->

<section class="references">

</section>

<!-- /.references -->

<!-- Section for all links. Make sure to keep an empty line after the `section` element and another before the `/section` close. -->

<section class="links">

[json]: http://www.json.org/

</section>

<!-- /.links -->
