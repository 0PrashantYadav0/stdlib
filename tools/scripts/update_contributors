#!/usr/bin/env bash
#
# Generates a CONTRIBUTORS file.
#
# This script is called with the following parameters:
#
# * `$1` - output file path


# VARIABLES #

# Set the output file path:
output_file="$1"

# Determine root directory:
root="$(git rev-parse --show-toplevel)"

# Resolve the relative file path of this script (see http://stackoverflow.com/questions/2564634/convert-absolute-path-into-relative-path-given-a-current-directory-using-bash):
this_script=$(perl -MFile::Spec -e 'print File::Spec->abs2rel(@ARGV)' "$0" "${root}")


# FUNCTIONS #

# Lists contributors.
list_contributors() {
	local contributors="$(git shortlog -sne | cut -f 2 | sort)"
	echo "${contributors}"
}

# Generates file contents.
#
# $1 - contributors
file_contents() {
cat << EOF
# This file is generated by $this_script.
#
# Contributors listed in alphabetical order.

$1
EOF
}

# Main execution sequence.
main() {
	file_contents "$(list_contributors)" > "${output_file}"
}

# Run main:
main
